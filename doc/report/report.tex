\documentclass[a4paper, 11pt]{report}
\usepackage[top=35mm,bottom=35mm,left=25mm,right=25mm]{geometry} % Margins

% Change section numbers
\renewcommand{\thesection}{\arabic{section}}

% Appendix
\usepackage{appendix}

% Decent underlines
\usepackage[normalem]{ulem}

% Hyperreferences
\usepackage{hyperref}

% Imports
\usepackage{import}

% Graphics and images
\usepackage{graphicx} \graphicspath{{./images/}}
\usepackage{tikz}
\usepackage{tikz-qtree}
\usetikzlibrary{automata, positioning, arrows}
\usepackage{subcaption}
\usepackage{float}

% Encodings (to render letters with diacritics and special characters)
\usepackage[utf8]{inputenc}

% Language
\usepackage[english]{babel}

% Source code and algorithms
%\usepackage{amsmath}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{listings}

% Tables with bold rows
\usepackage{tabularx}
\newcommand\setrow[1]{\gdef\rowmac{#1}#1\ignorespaces}
\newcommand\clearrow{\global\let\rowmac\relax}
\clearrow
\usepackage{multirow}

% Lists and items
\usepackage{enumitem}

% Math stuff
\usepackage[mathscr]{euscript}
\usepackage{amssymb, latexsym} %Load math symbols like \blacksquare, but also load normal \leadsto arrows
\usepackage{mathtools} % For \text{...}
% \usepackage{enumitem}
% \usepackage{xcolor}
\newcommand{\expnumber}[2]{{#1}\mathrm{e}{#2}} % scientific notation
\usepackage{siunitx} %SI units
\newcommand{\degree}{^{\circ}}

% Headers and footers
\usepackage{fancyhdr}
\pagestyle{fancyplain}
\fancyhf{}
\lhead{\fancyplain{}{Serial port data protocol â€” Report (RCOM 2020/21)}}
\rhead{\fancyplain{}{Class 2, group 4}}
\lfoot{\fancyplain{}{\leftmark}}
\rfoot{\thepage}

% Email
\newcommand{\email}[1]{
{\texttt{\href{mailto:#1}{#1}} }
}

% Metadata
\title{\Huge Serial port data protocol \\ \Large Report \\ \vspace*{4pt} \large RCOM 2020/21}
\author{
Class 2, group 4 \vspace{0.5em} \\
\begin{tabular}{r l}
	\email{up201800170@fe.up.pt} & Breno Accioly de Barros Pimentel \\
	\email{up201806429@fe.up.pt} & Diogo Miguel Ferreira Rodrigues  \\
\end{tabular}
}
\date{25th of May, 2020}

% Document
\begin{document}
\maketitle
\clearpage

\section*{Summary}

This project was elaborated in the context of the curricular unit Computer Networks (\textit{Redes de Computadores} - RCOM) as the first laboratory project. It concerns the design and implementation of a data link layer/protocol to allow two computers to communicate in a reliable way through serial ports. Additionally, an application was developed on top of that layer, to allow a computer to transfer a file to another.

Our main conclusions were...

% TODO

\section{Introduction} \label{sec:Introduction}

The present project aims at arriving at a design and implementation of a data link layer (LL) suited with its own data transfer protocol to allow communication between two computers physically connected through their serial ports (specifically, through RS-232 serial ports with asynchronous communication). The resulting source code was developed in the C language, targetting Linux devices.

This report is an artifact of the corresponding project, with the purpose of guiding readers through the process that was used to arrive at the project's goals. As such, this report is divided into seven main sections (excluding the \hyperref[sec:Introduction]{introduction} and \hyperref[sec:Conclusion]{conclusion}). In section \ref{sec:Architecture} we start by describing the generic architecture our program will follow in terms of layers and generic interfaces between layers, to then specity in section \ref{sec:CodeStructure} which specific layers implement the generic blocks of the previous section, the APIs each block will make available for inter-layer communication, and data structures used in each layer. Specific information for the end user on the main ways to use the program is presented in section \ref{sec:UseCases}. In sections \ref{sec:LLProtocol} and \ref{sec:AppProtocol} we identify the main functional aspects and implementation details of the logical link and application protocols respectively. Finally, in section \ref{sec:Validation} we test the program to validate it in terms of robustness of the program and results (efficacy) in face of errors or faulty communication media, and in section \ref{sec:Efficiency} we statistically describe the protocols' experimental efficiency and compare it to a theoretical Stop\&Wait protocol.

\section{Architecture} \label{sec:Architecture}

First of all, we designed the generic architecture of our system. It essentially consists of a lower, data link layer, which is responsible for dealing with the serial port through its driver and the facilities of abstraction through files/terminals provided by a Linux operating system, providing a simple interface to allow synchronous communication between two computers (a transmitter and a receiver), allowing to open/close ports and write/read generic data to them, and implementing some sort of error-control method; on top of that lower layer, is a high-level application made of two executable files, \texttt{transmitter} and \texttt{receiver}, which take advantage of the data link layer to transfer a file from the transmitter to the receiver, and provide a simple command line interface to the user.

\begin{figure}[H]
	\centering
	\begin{tikzpicture}[->,>=stealth',node distance=1.4cm,initial text=$ $,]
		\node[align=center, draw, minimum width=7cm, minimum height=1.4cm] (app) {Application};
		\node[align=center, draw, minimum width=7cm, minimum height=1.4cm, fill=black!10, below of=app] (link) {Data link};
		\node[align=center, draw, minimum width=7cm, minimum height=1.4cm, fill=black!20, below of=link] (driver) {Serial port driver \\ {\footnotesize \texttt{/dev/ttyS0}}};
		\node[align=center, draw, minimum width=7cm, minimum height=1.4cm, fill=black!30, below of=driver] (hardware) {Hardware \\ {\footnotesize RS-232 asynchronous serial port}};
		\node[align=center, above of=app] at (0, +0.7) (user){\includegraphics[scale=0.25]{actor.png}};
	
		\draw   (app) 		edge[align=center, left , bend right=88.5		] node{\small open port \\[-0.2em] \small write to port \\[-0.2em] \small close port} (link)
				(link) 		edge[align=center, right, bend right=88.5		] node{\small read from port} (app)
				(link) 		edge[align=center, left , bend right=88.5		] node{\small \texttt{open} \\[-0.2em] \small \texttt{tcsetattr} \\[-0.2em] \small \texttt{write}} (driver)
				(driver) 	edge[align=center, right, bend right=88.5		] node{\small \texttt{tcgetattr} \\[-0.2em] \small \texttt{read}} (link)
				(user) 		edge[align=center, left , bend right=60			] node{\small file to be transferred} (app)
				(app) 		edge[align=center, right, bend right=60			] node{\small transferred file} (user)
			;
	\end{tikzpicture}
	\caption{Architecture of the program to be developed}
\end{figure}

\section{Code structure} \label{sec:CodeStructure}

\begin{figure}[H]
	\centering
	\begin{tikzpicture}[->,>=stealth',node distance=2cm,initial text=$ $,]
		\node[align=center] at (-4.5, +2.2) (actor-transmitter){\includegraphics[scale=0.2]{actor.png}};
		\node[align=center] at (+4, +2.2) (actor-receiver)   {\includegraphics[scale=0.2]{actor.png}};
		\node[align=center, draw, minimum width=5cm, minimum height=1.3cm] at (-4.5, -0.3) (transmitter) {Transmitter \\ \footnotesize \texttt{transmitter} at \texttt{COM1}};
		\node[align=center, draw, minimum width=5cm, minimum height=1.3cm] at (+4, -0.3) (receiver) {Receiver \\ \footnotesize \texttt{receiver} at \texttt{COM2}};
		\node[align=center, draw, minimum width=5cm, minimum height=1.3cm, fill=black!10] at (-4.5, -2.6) (ll-transmitter) {Link Layer (LL) \\ \footnotesize \texttt{status=TRANSMITTER}};
		\node[align=center, draw, minimum width=5cm, minimum height=1.3cm, fill=black!10] at (+4, -2.6) (ll-receiver) {Link Layer (LL) \\ \footnotesize \texttt{status=RECEIVER}};
		\node[align=center, draw, minimum width=5cm, minimum height=1.3cm, fill=black!20] at (-4.5, -5.2) (driver-transmitter) {Serial port driver \\ \footnotesize \texttt{/dev/ttyS0}};
		\node[align=center, draw, minimum width=5cm, minimum height=1.3cm, fill=black!20] at (+4, -5.2) (driver-receiver) {Serial port driver \\ \footnotesize \texttt{/dev/ttyS1}};
		\node[align=center, draw, minimum width=5cm, minimum height=1.3cm, fill=black!30] at (-4.5, -7.2) (port-transmitter) {RS-232 serial port \\ \footnotesize \texttt{COM1}};
		\node[align=center, draw, minimum width=5cm, minimum height=1.3cm, fill=black!30] at (+4, -7.2) (port-receiver) {RS-232 serial port \\ \footnotesize \texttt{COM2}};

		\node[align=right] at (-8.3, -0.3) (app) {Application \\ layer};
		\node[align=right] at (-8.15, -2.6) (ll) {Data link \\ layer};
		\node[align=right] at (-8.25, -5.2) (app) {Serial port \\ drivers};
		\node[align=right] at (-8.2, -7.2) (app) {Hardware};
		
		\path   (-5, -3.25) 	edge[align=center, left		] node{\small \texttt{open}, \texttt{close} \\[-0.2em] \small \texttt{tcsetattr}} (-5, -4.55)
				(+3.5, -3.25) 	edge[align=center, left		] node{\small \texttt{open}, \texttt{close} \\[-0.2em] \small \texttt{tcsetattr}} (+3.5, -4.55)

				(-4, -4.55) 	edge[align=center, right	] node{\small \texttt{tcgetattr}} (-4, -3.25)
				(+4.5, -4.55) 	edge[align=center, right	] node{\small \texttt{tcgetattr}} (+4.5, -3.25)

				(-5, -5.85) 	edge[align=center, left		] node{} (-5, -6.55)
				(+3.5, -5.85) 	edge[align=center, left		] node{} (+3.5, -6.55)

				(-4, -6.55) 	edge[align=center, right	] node{} (-4, -5.85)
				(+4.5, -6.55) 	edge[align=center, right	] node{} (+4.5, -5.85)

				;

			\draw	(actor-transmitter)		edge[								]	node{\small \texttt{./transmitter 1 pinguim.gif}}	(transmitter)
					(receiver)				edge[								]	node{\small \texttt{./receiver 2 pinguim.gif}}	(actor-receiver)

					(transmitter)			edge[dashed, above					] node{\textit{transferring file...}} (receiver)

					(transmitter) 			edge[align=center, right	] node{\small \texttt{llopen}, \texttt{llclose}} (ll-transmitter)
					(receiver) 				edge[align=center, left		] node{\small \texttt{llopen}, \texttt{llclose}} (ll-receiver)

					(ll-transmitter) 		edge[dashed, align=center, above	] node{\small \texttt{llwrite} / \texttt{llread}} (ll-receiver)

					(driver-transmitter) 	edge[dashed, align=center, above	] node{\small \texttt{write} / \texttt{read}} (driver-receiver)

					(port-transmitter) 		edge[-, double, double distance=3pt, align=center, above	] node{\small physical cable} (port-receiver)
				;
	\end{tikzpicture}
	\caption{Architecture of the program to be developed}
\end{figure}

, and implementing a \textit{stop-and-wait} error-control protocol

which take advantage of the data link layer to transfer a file in chunks

\section{Main use cases} \label{sec:UseCases}

\section{Logical link protocol} \label{sec:LLProtocol}

\section{Application protocol} \label{sec:AppProtocol}

\section{Validation} \label{sec:Validation}

\section{Efficiency of the data link protocol} \label{sec:Efficiency}

\section{Conclusion} \label{sec:Conclusion}

\pagebreak

\appendix
\appendixpage
\addappheadtotoc
\section{Source code}

The source code of this project can be obtained in \href{https://github.com/dmfrodrigues/feup-rcom-l1}{github.com/dmfrodrigues/feup-rcom-l1}. The source code is made available by \textcopyright~Diogo Rodrigues and Breno Pimentel under the \href{https://www.gnu.org/licenses/gpl-3.0.en.html}{GNU General Public License v3} (GPLv3), which you should have received together with the source code, or that you can otherwise obtain online.

During project development and evaluation the repository remained private, although it can be shared with evaluators on request to clarify the development process. It will be made public once all equivalent curricular unit projects have been evaluated in the present school year.

% TODO: files

\end{document}
